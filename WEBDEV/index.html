<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    if (!localStorage.getItem('slsu_token')) {
      window.location.href = 'login.html';
    }
  </script>
  <title>SLSU Marketplace</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/marketplace.css">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
</head>
<body>

  <nav>
    <div class="nav__inner">
      <div class="nav__logo">
        <img src="assets/logo.png" alt="SLSU" onerror="this.style.display='none'" />
        <span class="site-title">SLSU <span class="accent">Marketplace</span></span>
      </div>

      <div class="nav__center">
        <button class="nav-pill active" onclick="route('browse')" data-route="browse">Browse</button>
        <button class="nav-pill" onclick="route('sell')" data-route="sell">Sell Item</button>
        <button class="nav-pill" onclick="route('business')" data-route="business">Create Business</button>
        <button class="nav-pill" onclick="route('my')" data-route="my">Dashboard</button>
      </div>

      <div class="nav__actions">
        <button class="btn-icon" id="openCart">
          <i class="ri-shopping-cart-2-line"></i>
          <span class="badge-count" id="cartCount">0</span>
        </button>

        <button class="btn-icon profile-trigger" id="openProfile">
          <div class="avatar profile-avatar-letter">U</div>
        </button>
      </div>
    </div>
  </nav>

  <div class="section__container" id="heroHeader">
    <div class="hero-card">
      <div class="hero-content">
        <h1>Buy & Sell within SLSU</h1>
        <p>Find text books, uniforms, and food from fellow students.</p>
        
        <div class="hero-search">
          <i class="ri-search-line"></i>
          <input type="text" id="q" placeholder="Search items..." />
          <button class="btn-search" id="runSearch">Search</button>
        </div>
      </div>
      <div class="hero-overlay"></div>
    </div>
  </div>

  <section class="section__container" id="browseSection">
    
    <div class="category-scroll-container">
      <div id="categoryIcons" class="category-row"></div>
    </div>

    <div class="browse-layout-grid">
      <div class="browse-main">
        <div class="section-flex-header">
          <h2 class="section-title">Featured Shops</h2>
        </div>
        <div id="featuredBizRow" class="featured-biz-row"></div>

        <h2 class="section-title" style="margin-top:2rem;">Fresh Listings</h2>
        <div class="grid grid-3" id="listings"></div>
        
        <div class="empty" id="emptyListings" style="display:none;">
          <div class="empty-state">
            <i class="ri-ghost-line" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
            <p>No items found matching your search.</p>
          </div>
        </div>
      </div>

      <aside class="browse-sidebar">
        <div class="sidebar-box">
          <div class="sidebar-header">
            <h3>Active Shops</h3>
            <span class="live-badge">Live Now</span>
          </div>
          <div id="activeBizList" class="ranked-list"></div>
        </div>
      </aside>
    </div>
  </section>

  <section class="section__container" id="businessPage" style="display:none;">
    <button class="btn btn-outline" onclick="route('browse')" style="margin-bottom:1rem;">
      <i class="ri-arrow-left-line"></i> Back
    </button>
    <div id="bizHeader"></div> <h3 class="section__header" style="margin-top:2rem;">Menu & Services</h3>
    <div class="grid grid-3" id="bizItemsGrid"></div>
  </section>

  <section class="section__container" id="sellSection" style="display:none;">
    <div class="form-container-limit" style="max-width: 800px; margin: auto;">
       <h2 class="section__header">List an Item</h2>
       <form id="sellForm" class="form">
         <input type="hidden" name="businessId" id="linkToBizId" value="" />
         
         <div id="bizLinkNotice" style="background:rgba(34,197,94,.1); color:#86efac; padding:0.8rem; border-radius:8px; display:none; margin-bottom:1rem;">
           <i class="ri-link"></i> Adding to business: <b id="bizLinkName"></b>
         </div>

         <div class="grid grid-2">
           <div class="input">
             <label>Item Title</label>
             <input required name="title" placeholder="e.g., Cheese Burger" />
           </div>
           <div class="input">
             <label>Price (PHP)</label>
             <input required name="price" type="number" min="0" step="0.01" />
           </div>
         </div>

         <div class="grid grid-2">
           <div class="input">
             <label>Category</label>
             <select name="category" required>
                <option value="Food & Drinks">Food & Drinks</option>
                <option value="Services">Services</option>
                <option value="Merch & Printing">Merch & Printing</option>
                <option value="Books">Books</option>
                <option value="Uniforms">Uniforms</option>
                <option value="Electronics">Electronics</option>
                <option value="Others">Others</option>
             </select>
           </div>
           <div class="input">
             <label>Condition</label>
             <select name="condition" required>
               <option>New / Fresh</option>
               <option>Service</option>
               <option>Like New</option>
               <option>Good</option>
             </select>
           </div>
         </div>

         <div class="input">
           <label>Description</label>
           <textarea name="description" rows="4"></textarea>
         </div>

         <div class="grid grid-2">
            <div class="input">
              <label>Photo</label>
              <div style="display:flex; align-items:center; gap:0.5rem; margin-bottom:0.3rem;">
                <label for="sellFile" class="btn" style="padding:0.6rem 1rem; width:auto;">
                  <i class="ri-camera-fill"></i> Upload
                </label>
                <span id="sellFileStatus" style="font-size:0.8rem; color:var(--muted); font-style:italic;">No file</span>
              </div>
              <input type="file" id="sellFile" accept="image/*" style="display:none;" />
              <input name="image" id="sellImageInput" placeholder="Or paste image URL..." />
            </div>
            <div class="input">
              <label>Contact</label>
              <input required name="contact" />
            </div>
         </div>

         <div class="toolbar" style="margin-top:1rem;">
           <button class="btn" type="submit"><i class="ri-upload-2-line"></i> Publish</button>
         </div>
       </form>
    </div>
  </section>

  <section class="section__container" id="businessSection" style="display:none;">
      </section>

  <section class="section__container" id="mySection" style="display:none;">
    <h2 class="section__header">My Dashboard</h2>
    <div class="tabs" id="myTabs" style="margin-bottom:1rem;">
      <div class="tab active" data-tab="listings">Items</div>
      <div class="tab" data-tab="orders">Orders</div>
      <div class="tab" data-tab="biz">Business</div>
    </div>
    <div id="myListings">
       <table class="data-table" style="width:100%; text-align:left;"><tbody id="myListingsBody"></tbody></table>
       <div class="empty" id="myListingsEmpty" style="display:none;">No items yet.</div>
    </div>
    <div id="myOrders" style="display:none;">
      <table class="data-table" style="width:100%; text-align:left;"><tbody id="myOrdersBody"></tbody></table>
      <div class="empty" id="myOrdersEmpty" style="display:none;">No orders yet.</div>
    </div>
    <div id="myBusinesses" style="display:none;">
      <table class="data-table" style="width:100%; text-align:left;"><tbody id="myBizBody"></tbody></table>
      <div class="empty" id="myBizEmpty" style="display:none;">No businesses yet.</div>
    </div>
  </section>

  <aside class="panel" id="cartPanel">
    <div class="panel__header">
      <h3>Your Cart</h3>
      <button class="btn-icon" id="closeCart"><i class="ri-close-line"></i></button>
    </div>
    <div class="panel__body" id="cartBody"></div>
    <div class="panel__footer">
      <div style="display:flex; justify-content:space-between; margin-bottom:1rem; font-weight:800;">
        <span>Total</span><span id="cartTotal">â‚±0.00</span>
      </div>
      <button class="btn-checkout" id="checkoutBtn">Checkout</button>
    </div>
  </aside>

  <div id="profileOverlay" class="profile-overlay">
    <aside class="profile-sidebar">
        <div class="profile-sidebar__header">
            <h2>Profile</h2>
            <button class="btn-icon" id="closeProfileSidebar"><i class="ri-close-line"></i></button>
        </div>
        <div class="profile-sidebar__body">
            <div class="profile-sidebar__user">
                <div class="profile-avatar-circle profile-avatar-letter">U</div>
                <div>
                    <div class="profile-display-name">Student User</div>
                    <div class="profile-email">student@slsu.edu.ph</div>
                </div>
            </div>
            
            <div class="profile-sidebar__section">
                <div class="profile-sidebar__label">Menu</div>
                <button class="profile-pill" onclick="route('my'); document.getElementById('profileOverlay').classList.remove('open')">
                    <i class="ri-dashboard-line"></i><span>Dashboard</span>
                </button>
                <button class="profile-pill" onclick="route('sell'); document.getElementById('profileOverlay').classList.remove('open')">
                    <i class="ri-add-circle-line"></i><span>Sell Item</span>
                </button>
                <button class="profile-pill" onclick="route('business'); document.getElementById('profileOverlay').classList.remove('open')">
                    <i class="ri-store-2-line"></i><span>Create Business</span>
                </button>
            </div>
            
            <div class="profile-sidebar__section">
                <div class="profile-sidebar__label">Settings</div>
                <div class="input">
                    <label>Display Name</label>
                    <input id="displayNameInput" placeholder="Update name" style="background:var(--surface-2); border:1px solid var(--stroke); padding:0.5rem; color:white; width:100%; border-radius:8px;">
                </div>
                <button class="btn" id="saveProfileBtn" style="width:100%; margin-top:0.5rem;">Save</button>
            </div>
        </div>
        <div class="profile-sidebar__footer">
             <button class="btn profile-logout-btn" id="profileLogoutBtn" onclick="logout()">
                <i class="ri-logout-box-r-line"></i> Logout
            </button>
        </div>
    </aside>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // Logout function
    function logout() {
        localStorage.removeItem('slsu_token');
        window.location.href = 'login.html';
    }
  </script>
  <script src="scripts/boot.js" defer></script>
</body>
</html>
