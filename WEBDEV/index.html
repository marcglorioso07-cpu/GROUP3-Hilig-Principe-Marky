<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="module" src="scripts/firebase-init.js"></script>
  <title>SLSU Marketplace</title>
  <link rel="stylesheet" href="styles/main.css">
  <link rel="stylesheet" href="styles/marketplace.css">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
</head>
<body>

  <nav>
    <div class="nav__inner">
      <div class="nav__logo">
        <img src="assets/logo.png" alt="SLSU" onerror="this.style.display='none'" />
        <span class="site-title">SLSU <span class="accent">Marketplace</span></span>
      </div>

<div class="nav__center">

  <button class="nav-pill active" onclick="route('browse')" data-route="browse">
    <i class="ri-compass-3-line"></i>
    <span>Browse</span>
  </button>

</div>



      <div class="nav__actions">
        <button class="btn-icon" id="openCart">
          <i class="ri-shopping-cart-2-line"></i>
          <span class="badge-count" id="cartCount">0</span>
        </button>

        <button class="btn-icon profile-trigger" id="openProfile">
  <div class="avatar profile-avatar" id="profileAvatarHeader" style="position:relative; overflow:hidden;">
    <span class="profile-avatar-letter" id="profileAvatarInitialHeader">U</span>
    <img id="profileAvatarImageHeader"
         alt="Profile avatar"
         style="display:none; width:100%; height:100%; object-fit:cover; border-radius:999px;" />
  </div>
</button>

      </div>
    </div>
  </nav>

  <div class="section__container" id="heroHeader">
    <div class="hero-card">
      <div class="hero-content">
        <h1>Buy & Sell within SLSU</h1>
        <p>Find text books, uniforms, and food from fellow students.</p>
        
        <div class="hero-search">
          <i class="ri-search-line"></i>
          <input type="text" id="q" placeholder="Search items..." />
          <button class="btn-search" id="runSearch">Search</button>
        </div>
      </div>
      <div class="hero-overlay"></div>
    </div>
  </div>

  <section class="section__container" id="browseSection">
    <div class="category-scroll-container">
      <div id="categoryIcons" class="category-row"></div>
    </div>

    <div class="browse-layout-grid">
      <div class="browse-main">
        <div class="section-flex-header">
          <h2 class="section-title">Featured Shops</h2>
        </div>
        <div id="featuredBizRow" class="featured-biz-row"></div>

        <h2 class="section-title" style="margin-top:2rem;">Fresh Listings</h2>
        <div class="grid grid-3" id="listings"></div>
        
        <div class="empty" id="emptyListings" style="display:none;">
          <div class="empty-state">
            <i class="ri-ghost-line" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
            <p>No items found matching your search.</p>
          </div>
        </div>
      </div>

      <aside class="browse-sidebar">
        <div class="sidebar-box">
          <div class="sidebar-header">
            <h3>Active Shops</h3>
            <span class="live-badge">Live Now</span>
          </div>
          <div id="activeBizList" class="ranked-list"></div>
        </div>
      </aside>
    </div>
  </section>

  <section class="section__container" id="businessPage" style="display:none;">
    <button class="btn btn-outline" onclick="route('browse')" style="margin-bottom:1rem;">
      <i class="ri-arrow-left-line"></i> Back
    </button>
    <div id="bizHeader"></div>
    <h3 class="section__header" style="margin-top:2rem;">Menu & Services</h3>
    <div class="grid grid-3" id="bizItemsGrid"></div>
  </section>

<section class="section__container" id="sellSection" style="display:none;">
  <div class="form-container-limit" style="max-width: 800px; margin: auto;">
     <h2 class="section__header">List an Item</h2>
     <p style="color:var(--muted); margin-bottom:1.5rem; font-size:0.9rem;">
       Fill in the details below to publish your item to the marketplace.
     </p>

     <form id="sellForm" class="form sell-form">
       <input type="hidden" name="businessId" id="linkToBizId" value="" />
       
       <div id="bizLinkNotice" style="background:rgba(34,197,94,1); color:#022c22; padding:0.8rem 1rem; border-radius:10px; display:none; margin-bottom:1.25rem; border:1px solid rgba(22,163,74,0.6);">
         <i class="ri-link"></i> Adding to business: <b id="bizLinkName"></b>
       </div>

       <div class="grid grid-2">
         <div class="input">
           <label>Item Title</label>
           <input required name="title" placeholder="e.g. Cheese Burger" />
         </div>
         <div class="input">
           <label>Price (PHP)</label>
           <input required name="price" type="number" min="0" step="0.01" />
         </div>
       </div>

       <div class="grid grid-2">
         <div class="input">
           <label>Category</label>
           <select name="category" required>
             <option value="Food & Drinks">Food & Drinks</option>
             <option value="Services">Services</option>
             <option value="Merch & Printing">Merch & Printing</option>
             <option value="Books">Books</option>
             <option value="Uniforms">Uniforms</option>
             <option value="Electronics">Electronics</option>
             <option value="Others">Others</option>
           </select>
         </div>
         <div class="input">
           <label>Condition</label>
           <select name="condition" required>
             <option>New / Fresh</option>
             <option>Service</option>
             <option>Like New</option>
             <option>Good</option>
           </select>
         </div>
       </div>

       <div class="input">
         <label>Description</label>
         <textarea name="description" rows="4" placeholder="Describe your item, size, flavor, or extra notes..."></textarea>
       </div>

       <div class="grid grid-2">
          <div class="input">
            <label>Photo</label>
            <div class="sell-photo-row">
              <label for="sellFile" class="sell-upload-btn">
                <i class="ri-camera-fill"></i>
                <span>Upload</span>
              </label>
              <span id="sellFileStatus">No file selected</span>
            </div>
            <input type="file" id="sellFile" accept="image/*" style="display:none;" />
            <input name="image" id="sellImageInput" placeholder="Or paste image URL..." />
          </div>
          <div class="input">
            <label>Contact</label>
            <input required name="contact" placeholder="Phone or Messenger link" />
          </div>
       </div>

       <div class="toolbar sell-toolbar">
         <button class="btn" type="submit"><i class="ri-upload-2-line"></i> Publish</button>
       </div>
     </form>
  </div>
</section>


  <section class="section__container" id="businessSection" style="display:none;">
      </section>

<section class="section__container" id="mySection" style="display:none;">
  <div class="dashboard-shell">
    <div class="dashboard-top">
      <div>
        <h2 class="section__header" style="margin-bottom:0.25rem;">My Dashboard</h2>
        <p class="dashboard-subtitle">
          View your listed items, recent orders, and active businesses in one place.
        </p>
      </div>
      <div class="dashboard-tags">
    
      </div>
    </div>

    <div class="tabs dashboard-tabs" id="myTabs">
      <div class="tab" data-tab="listings">Items</div>
      <div class="tab" data-tab="orders">Orders</div>
      <div class="tab active" data-tab="businesses">Business</div>
    </div>

    <div class="dashboard-content">
      <!-- ITEMS TAB -->
      <div id="myListings" style="display:none;">
        <div id="myListingsBody"></div> 
        <div class="empty empty-dashboard" id="myListingsEmpty">
          <i class="ri-shopping-bag-line empty-icon"></i>
          <p>You haven't listed any individual items yet.</p>
        </div>
      </div>

      <!-- ORDERS TAB -->
      <div id="myOrders" style="display:none;">
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Customer</th>
                <th>Name</th>
                <th>Category</th>
                <th>Total</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="myOrdersBody"></tbody>
          </table>
        </div>
        <div class="empty empty-dashboard" id="myOrdersEmpty">
          <i class="ri-clipboard-line empty-icon"></i>
          <p>No orders yet.</p>
        </div>
      </div>

      <!-- BUSINESSES TAB -->
      <div id="myBusinesses">
        <div id="myBizBody"></div> 
        <div class="empty empty-dashboard" id="myBizEmpty">
          <i class="ri-store-line empty-icon"></i>
          <p>You haven't launched any businesses yet.</p>
          <button class="btn" onclick="route('business'); document.getElementById('profileOverlay').classList.remove('open')" style="margin-top: 1rem;">
            <i class="ri-rocket-line"></i> Create Business
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

    
    <div id="myOrders" style="display:none;">
      <table class="data-table" style="width:100%; text-align:left;">
        <thead>
  <tr>
    <th>Order ID</th>
    <th>Customer</th>
    <th>Item</th>
    <th>Category</th>
    <th>Total</th>
    <th>Date</th>
    <th>Status</th>
  </tr>
</thead>

        <tbody id="myOrdersBody"></tbody>
      </table>
      <div class="empty" id="myOrdersEmpty" style="display:none; text-align:center; padding: 2rem; color:var(--muted);">
        <i class="ri-clipboard-line" style="font-size: 2rem;"></i>
        <p>No orders yet.</p>
      </div>
    </div>
    
    <div id="myBusinesses">
      <!-- RENDER CARDS HERE -->
      <div id="myBizBody"></div> 
      <div class="empty" id="myBizEmpty" style="display:none; text-align:center; padding: 2rem; color:var(--muted);">
        <i class="ri-store-line" style="font-size: 2 rem;"></i>
        <p>You haven't launched any businesses yet.</p>
        <button class="btn" onclick="route('business'); document.getElementById('profileOverlay').classList.remove('open')" style="margin-top: 1rem;">Create Business</button>
      </div>
    </div>
  </section>

  <aside class="panel" id="cartPanel">
    <div class="panel__header">
      <h3>Your Cart</h3>
      <button class="btn-icon" id="closeCart"><i class="ri-close-line"></i></button>
    </div>
    <div class="panel__body" id="cartBody"></div>
    <div class="panel__footer">
      <div style="display:flex; justify-content:space-between; margin-bottom:1rem; font-weight:800;">
        <span>Total</span><span id="cartTotal">₱0.00</span>
      </div>
      <button class="btn-checkout" id="checkoutBtn">Checkout</button>
    </div>
  </aside>

  <div id="profileOverlay" class="profile-overlay">
    <aside class="profile-sidebar">
        <div class="profile-sidebar__header">
          <h2>Profile</h2>
          <button class="btn-icon" id="closeProfileSidebar"><i class="ri-close-line"></i></button>
        </div>
        <div class="profile-sidebar__body">
         <div class="profile-sidebar__user">
  <div class="profile-avatar-circle" id="profileAvatarSidebar"
       style="position:relative; overflow:hidden; cursor:pointer;">
    <span class="profile-avatar-letter" id="profileAvatarInitialSidebar">M</span>
    <img id="profileAvatarImageSidebar"
         alt="Profile avatar"
         style="display:none; width:100%; height:100%; object-fit:cover; border-radius:999px;" />
  </div>
  <div>
    <div class="profile-display-name">Marc</div>
    <div class="profile-email">student@slsu.edu.ph</div>
  </div>
</div>

<!-- hidden file input for avatar upload -->
<input type="file" id="profileAvatarFile" accept="image/*" style="display:none;">


          
          <div class="profile-sidebar__section">
              <div class="profile-sidebar__label">MENU</div>
              <button class="profile-menu-link" onclick="route('my'); document.getElementById('profileOverlay').classList.remove('open')">
                <i class="ri-dashboard-line"></i><span>Dashboard</span>
              </button>
              <button class="profile-menu-link" onclick="route('sell'); document.getElementById('profileOverlay').classList.remove('open')">
                <i class="ri-add-circle-line"></i><span>Sell Item</span>
              </button>
              <button class="profile-menu-link" onclick="route('business'); document.getElementById('profileOverlay').classList.remove('open')">
                <i class="ri-store-2-line"></i><span>Create Business</span>
              </button>
          </div>
          
          <div class="profile-sidebar__section">
              <div class="profile-sidebar__label">SETTINGS</div>
              <div class="input">
                <label>Display Name</label>
                <input id="displayNameInput" value="Marc" style="background:var(--surface-2); border:1px solid var(--stroke); padding:0.6rem; color:white; width:100%; border-radius:8px;">
              </div>
              <button class="btn" id="saveProfileBtn" style="width:100%; margin-top:0.8rem;">Save</button>
          </div>
        </div>
        
        <div class="profile-sidebar__footer">
             <button class="btn profile-logout-btn" id="profileLogoutBtn" onclick="logout()">
               <i class="ri-logout-box-r-line"></i> Logout
            </button>
        </div>
    </aside>
  </div>

  <!-- FOOTER -->
<footer style="
  margin-top:1.5rem;
  border-top:1px solid var(--stroke);
  background:var(--surface-2);
  padding:1.2rem 0 1.6rem;
  box-shadow:0 -2px 10px rgba(0,0,0,0.22);
">
  <div class="section__container"
       style="
         display:flex;
         flex-direction:column;
         align-items:center;
         justify-content:center;
         gap:0.9rem;
         text-align:center;
       ">
    
    <!-- LOGO + DESCRIPTION -->
    <div style="
      display:flex; 
      align-items:center; 
      gap:0.6rem; 
      font-size:1.7rem;      /* BIG TITLE */
      color:var(--muted);
      font-weight:700;
    ">
      <i class="ri-store-3-line" style="font-size:1.9rem; color:var(--accent);"></i>
      <span>SLSU Marketplace</span>
    </div>

    <!-- COPYRIGHT -->
    <div style="
      font-size:0.9rem; 
      color:var(--muted); 
      margin-top:0.3rem;
    ">
      © 2025 SLSU Marketplace. All rights reserved.
    </div>

    <!-- GLOW LINE -->
    <div style="
      width:100%;
      max-width:260px;
      height:2px;
      margin-top:0.35rem;
      background:linear-gradient(
        90deg,
        transparent,
        var(--accent),
        transparent
      );
      box-shadow:0 0 7px var(--accent);
      border-radius:2px;
    "></div>

  </div>
</footer>


<!-- FOOTER HOVER EFFECTS -->
<style>
  .footer-btn {
    background:transparent;
    border:none;
    color:var(--muted);
    cursor:pointer;
    font-size:1.1rem;     /* LARGER */
    padding:0.25rem 0.4rem;
    transition:0.25s ease;
  }

  .footer-btn:hover {
    color:var(--accent);
    text-shadow:0 0 6px var(--accent);
    transform:translateY(-2px);
  }
</style>



  <div class="toast" id="toast"></div>

  <script>
    // Guard: if no Firebase user, kick back to login
    document.addEventListener('DOMContentLoaded', () => {
      const ns = window.firebaseNS || {};
      const { auth, onAuthStateChanged } = ns;
      if (!auth || !onAuthStateChanged) return;

      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          window.location.href = 'login.html';
        } else {
          // Load Firestore profile and update UI
          try {
            await window.getCurrentUserProfile?.();
          } catch (e) {
            console.error('Profile load error', e);
          }
        }
      });
    });

    async function logout() {
      const ns = window.firebaseNS || {};
      const { auth, signOut } = ns;
      if (!auth || !signOut) {
        window.location.href = 'login.html';
        return;
      }
      try {
        await signOut(auth);
      } finally {
        window.location.href = 'login.html';
      }
    }
  </script>

  <script src="scripts/boot.js" defer></script>
</body>
</html>
